
<!DOCTYPE html>
<html>
<head>
    <title>Csound HTML Tutorial 04</title>
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="-1"></head>
<body>
   <style type="text/css">
    input[type='range'] {
        -webkit-appearance: none;
        border-radius: 5px;
        box-shadow: inset 0 0 5px #333;
        background-color: #999;
        height: 10px;
        width: 100%;
        vertical-align: middle;
    }
    input[type=range]::-webkit-slider-thumb {
        -webkit-appearance: none;
        border: none;
        height: 16px;
        width: 16px;
        border-radius: 50%;
        background: yellow;
        margin-top: -4px;
        border-radius: 10px;
    }
    table td {
        border-width: 2px;
        padding: 8px;
        border-style: solid;
        border-color: transparent;
        color:yellow;
        background-color: teal;
        font-family: sans-serif
    }
    table th {
        border-width: 2px;
        padding: 8px;
        border-style: solid;
        border-color: transparent;
        color:white;
        background-color:teal;
         font-family: sans-serif
   }
    textarea.console {
        border-width: 2px;
        padding: 8px;
        border-style: solid;
        border-color: gray;
        color:green;
        background-color:black;
        font-family: 'Courier', sans-serif
    }
    textarea.code {
        border-width: 2px;
        padding: 8px;
        border-style: solid;
        border-color: gray;
        color:black;
        background-color:white;
        font-family: 'Courier', sans-serif
    }
    h1 {
	margin: 1em 0 0.5em 0;
	color: #343434;
	font-weight: normal;
	font-family: 'Ultra', sans-serif;   
	font-size: 36px;
	line-height: 42px;
	text-transform: uppercase;
    }
    h2 {
        margin: 1em 0 0.5em 0;
        color: #343434;
        font-weight: normal;
        font-size: 30px;
        line-height: 40px;
        font-family: 'Orienta', sans-serif;
    }    
        h3 {
        margin: 1em 0 0.5em 0;
        color: #343434;
        font-weight: normal;
        font-size:24px;
        line-height: 30px;
        font-family: 'Orienta', sans-serif;
    }    
    </style>
    <h1>Csound HTML Tutorial 04</h1>
    <h2>Introduction</h3>
    <p>The purpose of this tutorial is to demonstrate an interactive composition in WebGL and GLSL shaders generate 
    an animated, three-dimensional fractal that also generates a Csound score in real time. As the fractal moves 
    towards the viewer, it passes through an invisible plane in the view frustum. As certain vertexes pass through 
    this plane, they generate Csound notes, flashing as they do so. Attributes of a vertex control the instrument 
    choice, loudness, and stereo position of the note. Attributes of the scene as a whole control transformations 
    that are applied to a chord to which the notes are conformed. The evolution of the fractal is controlled by a 
    few sliders, which thus control the evolution of the music as well.</p>
    </p>You can play the piece, stop it from playing, use the sliders 
    to control the sounds of the instruments as they play, view and edit the Csound code, and see Csound's diagnostic 
    messages. You may find this piece immediately below. Go ahead and try it -- it will play on version 31 or later of 
    Google's Chrome browser for OS X, Windows, or Linux. A thorough explanation of the steps required to create this 
    Web page using the PNaCl build of Csound follows.</p>
    <h2>Dunes v 4</h2>
    <h4>By Michael Gogins</h3>
    <h4>2015</h4> 
    
    <form id='persist'>
    
    <table>
    <col width="2*">
    <col width="5*">
    <col width="100px">

    <th colspan=3 align='left'>Droner</th>
    <tr>
    <td>
    <label for=gk_Droner_slider1>gk_Droner_slider1</label>
    <td>
    <input class=persistent-element type=range min=0 max=1 value=.25 id=gk_Droner_slider1 step=.001>
    <td>
    <output for=gk_Droner_slider1 id=gk_Droner_slider1_output>.5</output>
    </tr>
    <tr>
    <td>
    <label for=gk_Droner_slider2>gk_Droner_slider2</label>
    <td>
    <input class=persistent-element type=range min=0 max=1 value=.5 id=gk_Droner_slider2 step=.001>
    <td>
    <output for=gk_Droner_slider2 id=gk_Droner_slider2_output>.5</output>
    </tr>
    <tr>
    <td>
    <label for=gk_Droner_slider3>gk_Droner_slider3</label>
    <td>
    <input class=persistent-element type=range min=0 max=1 value=.75 id=gk_Droner_slider3 step=.001>
    <td>
    <output for=gk_Droner_slider3 id=gk_Droner_slider3_output>.5</output>
    </tr>
    <tr>
    <td>
    <label for=gk_Droner_slider4>gk_Droner_slider4</label>
    <td>
    <input class=persistent-element type=range min=0 max=1 value=.5 id=gk_Droner_slider4 step=.001>
    <td>
    <output for=gk_Droner_slider4 id=gk_Droner_slider4_output>.5</output>
    </tr>
    <tr>
    <td>
    <label for=gk_Droner_slider5>gk_Droner_slider5</label>
    <td>
    <input class=persistent-element type=range min=0 max=1 value=.125 id=gk_Droner_slider5 step=.001>
    <td>
    <output for=gk_Droner_slider5 id=gk_Droner_slider5_output>.5</output>
    </tr>

    <th colspan=3 align='left'>Buzzer</th>
    <tr>
    <td>
    <label for=gk_Buzzer_harmonics>gk_Buzzer_harmonics</label>
    <td>
    <input class=persistent-element type=range min=0 max=20 value=3 id=gk_Buzzer_harmonics step=.001>
    <td>
    <output for=gk_Buzzer_harmonics id=gk_Buzzer_harmonics_output>.5</output>
    </tr>

    <th colspan=3 align='left'>Sweeper</th>
    <tr>
    <td>
    <label for=gk_Sweeper_britel>gk_Sweeper_britel</label>
    <td>
    <input class=persistent-element type=range min=0 max=5 value=.25 id=gk_Sweeper_britel step=.001>
    <td>
    <output for=gk_Sweeper_britel id=gk_Sweeper_britel_output>.5</output>
    </tr>
    <tr>
    <td>
    <label for=gk_Sweeper_briteh>gk_Sweeper_briteh</label>
    <td>
    <input class=persistent-element type=range min=0 max=5 value=.25 id=gk_Sweeper_briteh step=.001>
    <td>
    <output for=gk_Sweeper_briteh id=gk_Sweeper_briteh_output>.5</output>
    </tr>
    <tr>
    <td>
    <label for=gk_Sweeper_britels>gk_Sweeper_britels</label>
    <td>
    <input class=persistent-element type=range min=0 max=5 value=.25 id=gk_Sweeper_britels step=.001>
    <td>
    <output for=gk_Sweeper_britels id=gk_Sweeper_britels_output>.5</output>
    </tr>
    <tr>
    <td>
    <label for=gk_Sweeper_britehs>gk_Sweeper_britel</label>
    <td>
    <input class=persistent-element type=range min=0 max=5 value=.25 id=gk_Sweeper_britehs step=.001>
    <td>
    <output for=gk_Sweeper_britehs id=gk_Sweeper_britehs_output>.5</output>
    </tr>

    <th colspan=3 align='left'>Blower</th>
    <tr>
    <td>
    <label for=gk_Blower_grainDensity>gk_Blower_grainDensity</label>
    <td>
    <input class=persistent-element type=range min=0 max=500 value=150 id=gk_Blower_grainDensity step=.001>
    <td>
    <output for=gk_Blower_grainDensity id=gk_Blower_grainDensity_output>.5</output>
    </tr>
    <tr>
    <td>
    <label for=gk_Blower_grainDuration>gk_Blower_grainDuration</label>
    <td>
    <input class=persistent-element type=range min=0 max=2 value=.25 id=gk_Blower_grainDuration step=.001>
    <td>
    <output for=gk_Blower_grainDuration id=gk_Blower_grainDuration_output>.5</output>
    </tr>
    <tr>
    <td>
    <label for=gk_Blower_grainAmplitudeRange>gk_Blower_grainAmplitudeRange</label>
    <td>
    <input class=persistent-element type=range min=0 max=500 value=100 id=gk_Blower_grainAmplitudeRange step=.001>
    <td>
    <output for=gk_Blower_grainAmplitudeRange id=gk_Blower_grainAmplitudeRange_output>100</output>
    </tr>
    <tr>
    <td>
    <label for=gk_Blower_grainFrequencyRange>gk_Blower_grainFrequencyRange</label>
    <td>
    <input class=persistent-element type=range min=0 max=2 value=.033 id=gk_Blower_grainFrequencyRange step=.001>
    <td>
    <output for=gk_Blower_grainFrequencyRange id=gk_Blower_grainFrequencyRange_output>.5</output>
    </tr>

    <th colspan=3 align='left'>Master</th>
    <tr>
    <td>
    <label for=gk_Reverb_Feedback>gk_Reverb_Feedback</label>
    <td>
    <input class=persistent-element type=range min=0 max=1 id=gk_Reverb_Feedback step=.001>
    <td>
    <output for=gk_Reverb_Feedback id=gk_Reverb_Feedback_output>.5</output>
    </tr>
    <tr>
    <td>
    <label for=gk_MasterOutput_gain>gk_MasterOutput_gain</label>
    <td>
    <input class=persistent-element type=range min=0 max=5 id=gk_MasterOutput_gain step=.001>
    <td>
    <output for=gk_MasterOutput_gain id=gk_MasterOutput_gain_output>.5</output>
    </tr>

    </table>
 
    <br>
    <input type="button" id='play' value="Play" />
    <input type="button" id='stop' value="Stop" />
    <input type="button" id='save' value="Save" />
    <input type="button" id='restore' value="Restore" />

    </form>
    <h4>Csound Errors, Warnings, and Messages</h4>
    <textarea class="console" id="console" rows=10 cols=80></textarea>
    
        <div>
        <canvas width="675" height="924">
        </canvas>
        <div style="cursor: pointer; width: 80px; opacity: 0.9; z-index: 10001; position: absolute; top: 5px; right: 5px;"><div style="padding: 2px 0px 3px; background-color: rgb(8, 8, 24);"><div style="font-family: Helvetica, Arial, sans-serif; text-align: left; font-size: 9px; color: rgb(0, 255, 255); margin: 0px 0px 1px 3px;"><span style="font-weight:bold">51 FPS</span> (11-59)</div><canvas width="74" height="30" style="display: block; margin-left: 3px;"></canvas></div><div style="padding: 2px 0px 3px; display: none; background-color: rgb(8, 24, 8);"><div style="font-family: Helvetica, Arial, sans-serif; text-align: left; font-size: 9px; color: rgb(0, 255, 0); margin: 0px 0px 1px 3px;"><span style="font-weight:bold">17 MS</span> (3-798)</div><canvas width="74" height="30" style="display: block; margin-left: 3px;"></canvas></div><div style="padding: 2px 0px 3px; display: none; background-color: rgb(24, 8, 13);"><div style="font-family: Helvetica, Arial, sans-serif; text-align: left; font-size: 9px; color: rgb(255, 0, 128); margin: 0px 0px 1px 3px;"><span style="font-weight:bold">48 MB</span> (48-48)</div><canvas width="74" height="30" style="display: block; margin-left: 3px;">
        </canvas></div></div></div>
        <div id="info">Hopalong Orbits Music Generator - Created using <a href="http://github.com/mrdoob/three.js" target="_blank">three.js</a>
        <br> [Mouse Move] Camera position
        <br> [Up-Down] Control speed - [Left-Right] Control rotation
        <br> [H] Toggle info and cursor - [F11] Toggle fullscreen
        </div>
        <div id="aboutlink">
        <a href="javascript:showHideAbout()">About</a>
    </div>
    <div id="about" style="display: none;">
            <b>Barry Martin's Hopalong Orbits Visualizer</b>
            <p>Adapted for music generation for Csound by Michael Gogins</p>
            <p?Based on code by Iacopo Sassarini<p>
            <p>Orbits are generated by iterating this simple algorithm:</p>

            <p>(x, y) -&gt; (y - sign(x)*sqrt(abs(b*x - c)), a -x )</p>

            <p>where a, b, c are random parameters. This is known as the 'Hopalong Attractor'.</p>
            <p>3D rendering is done using WebGL and <a href="http://github.com/mrdoob/three.js" target="_blank">three.js</a></p>
    </div>
    
    
    <h4>Csound Orchestra</h4>
    <textarea class="code" id="orc" rows=24 cols=80>
opcode hertz2midinn, i, i
ihertz xin
print ihertz
; m = 12*log2(fm/440 Hz) + 69
ilog2 = log(2)
imidinn = 12 * (log(ihertz / 440) / ilog2) + 69
print imidinn
xout imidinn
endop

instr 101
insno = p1
istart = p2
iduration = p3
ihertz = p4
ivelocity = p5
ipan = p6
ikey hertz2midinn ihertz
event_i "i", "Droner", 0, iduration, ikey, ivelocity, 0, ipan
endin

instr 102
insno = p1
istart = p2
iduration = p3
ihertz = p4
ivelocity = p5
ipan = p6
ikey hertz2midinn ihertz
event_i "i", "Buzzer", 0, iduration, ikey, ivelocity, 0, ipan
endin

instr 103
insno = p1
istart = p2
iduration = p3
ihertz = p4
ivelocity = p5
ipan = p6
ikey hertz2midinn ihertz
event_i "i", "Sweeper", 0, iduration, ikey, ivelocity, 0, ipan
endin

instr 104
insno = p1
istart = p2
iduration = p3
ihertz = p4
ivelocity = p5
ipan = p6
ikey hertz2midinn ihertz
event_i "i", "Blower", 0, iduration, ikey, ivelocity, 0, ipan
endin

gi_Droner_overlap init 20
gk_Droner_distort_factor init 0.4
gk_Droner_first_harmonic init 0.4
gk_Droner_slider1 init .05
gk_Droner_slider2 init .1
gk_Droner_slider3 init .04
gk_Droner_slider4 init .2
gk_Droner_slider5 init .02
gi_Droner_sine ftgen 0, 0, 65536, 10, 1, 0, .02
instr Droner
insno = p1
istart = p2
iduration = p3
ikey = p4
ivelocity = p5
iphase = p6
ipan = p7
k1 init .5
k2 init .05
k3 init .1
k4 init .2
k5 init .1
k6 init .05
k7 init .1
k8 init 0
k9 init 0
k10 init 0
k3 = gk_Droner_slider1
k4 = gk_Droner_slider2
k5 = gk_Droner_slider3
k6 = gk_Droner_slider4
k7 = gk_Droner_slider5
kwaveform init 0
iamp = ampdb(ivelocity)
iattack = gi_Droner_overlap
idecay = gi_Droner_overlap
isustain = p3 - gi_Droner_overlap
p3 = iattack + isustain + idecay
kenvelope transeg 0.0, iattack / 2.0, 1.5, iamp / 2.0, iattack / 2.0, -1.5, iamp, isustain, 0.0, iamp, idecay / 2.0, 1.5, iamp / 2.0, idecay / 2.0, -1.5, 0
ihertz = cpsmidinn(ikey)
if kwaveform == 0 then
asignal poscil3 1, ihertz, gi_Droner_sine
endif
if kwaveform == 1 then
asignal vco2 1, ihertz, 8 ; integrated saw
endif
if kwaveform == 2 then
asignal vco2 1, ihertz, 12 ; triangle
endif
asignal chebyshevpoly asignal, 0, k1, k2, k3, k4, k5, k6, k7, k8, k9, k10
asignal = asignal * kenvelope * 10
aleft, aright pan2 asignal, ipan
adamping linseg 0, 0.03, 1, p3 - 0.1, 1, 0.07, 0
aleft = adamping * aleft
aright = adamping * aright
chnmix aleft, "out_left"
chnmix aright, "out_right"
prints "instr %4d t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f\n", p1, p2, p3, p4, p5, p7
endin

gi_Bower_overlap init 20
gi_Bower_sine ftgen 0,0,65536,10,1
instr Bower
insno = p1
istart = p2
iduration = p3
ikey = p4
ivelocity = p5
iphase = p6
ipan = p7
iamp = ampdb(ivelocity) * 200
iattack = gi_Bower_overlap
idecay = gi_Bower_overlap
isustain = p3 - gi_Bower_overlap
p3 = iattack + isustain + idecay
kenvelope transeg 0.0, iattack / 2.0, 1.5, iamp / 2.0, iattack / 2.0, -1.5, iamp, isustain, 0.0, iamp, idecay / 2.0, 1.5, iamp / 2.0, idecay / 2.0, -1.5, 0
ihertz = cpsmidinn(ikey)
kamp = kenvelope
kfreq = ihertz
kpres = 0.25
; krat rspline 0.006,0.988,0.1,0.4
krat rspline 0.006,0.988,1,4
kvibf = 4.5
kvibamp = 0
iminfreq = 20
aSig wgbow kamp,kfreq,kpres,krat,kvibf,kvibamp,gi_Bower_sine,iminfreq
;aSig butlp aSig,2000
;aSig pareq aSig,80,6,0.707
aleft, aright pan2 aSig / 7, ipan
adamping linseg 0, 0.03, 1, p3 - 0.1, 1, 0.07, 0
chnmix aleft, "out_left"
chnmix aright, "out_right"
prints "instr %4d t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f\n", p1, p2, p3, p4, p5, p7
endin

gi_Phaser_overlap init 20
gk_Phaser_ratio1 init 1
gk_Phaser_ratio2 init 1/3
gk_Phaser_index1 init 1
gk_Phaser_index2 init 0.0125
gi_Phaser_sine ftgen 0,0,65536,10,1
instr Phaser
insno = p1
istart = p2
iduration = p3
ikey = p4
ivelocity = p5
iphase = p6
ipan = p7
iamp = ampdb(ivelocity) * 8
iattack = gi_Phaser_overlap
idecay = gi_Phaser_overlap
isustain = p3 - gi_Phaser_overlap
p3 = iattack + isustain + idecay
kenvelope transeg 0.0, iattack / 2.0, 1.5, iamp / 2.0, iattack / 2.0, -1.5, iamp, isustain, 0.0, iamp, idecay / 2.0, 1.5, iamp / 2.0, idecay / 2.0, -1.5, 0
ihertz = cpsmidinn(ikey)
khertz = ihertz
ifunction1 = gi_Phaser_sine
ifunction2 = gi_Phaser_sine
a1,a2 crosspm gk_Phaser_ratio1, gk_Phaser_ratio2, gk_Phaser_index1, gk_Phaser_index2, khertz, ifunction1, ifunction2
aleft, aright pan2 a1+a2, ipan
adamping linseg 0, 0.03, 1, p3 - 0.1, 1, 0.07, 0
aleft = adamping * aleft * kenvelope
aright = adamping * aright * kenvelope
chnmix aleft, "out_left"
chnmix aright, "out_right"
prints "instr %4d t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f\n", p1, p2, p3, p4, p5, p7
endin

gi_Sweeper_overlap init 20
gk_Sweeper_britel init 0
gk_Sweeper_briteh init 2.9
gk_Sweeper_britels init .2 / 3
gk_Sweeper_britehs init 2.5 / 2
gi_Sweeper_sine ftgen 0, 0, 65536, 10, 1
gi_Sweeper_octfn ftgen 0, 0, 65536, -19, 1, 0.5, 270, 0.5
instr Sweeper
insno = p1
istart = p2
iduration = p3
ikey = p4
ivelocity = p5
iphase = p6
ipan = p7
iamp = ampdb(ivelocity)
iattack = gi_Sweeper_overlap
idecay = gi_Sweeper_overlap
isustain = p3 - gi_Sweeper_overlap
p3 = iattack + isustain + idecay
kenvelope transeg 0.0, iattack / 2.0, 1.5, iamp / 2.0, iattack / 2.0, -1.5, iamp, isustain, 0.0, iamp, idecay / 2.0, 1.5, iamp / 2.0, idecay / 2.0, -1.5, 0
ihertz = cpsmidinn(ikey)
icps = ihertz
kamp expseg 0.001,0.02,0.2,p3-0.01,0.001
ktonemoddep jspline 0.01,0.05,0.2
ktonemodrte jspline 6,0.1,0.2
ktone poscil3 ktonemoddep, ktonemodrte, gi_Sweeper_sine
kbrite rspline gk_Sweeper_britel, gk_Sweeper_briteh, gk_Sweeper_britels, gk_Sweeper_britehs
ibasfreq init icps
ioctcnt init 3
iphs init 0
;a1 hsboscil kamp, ktone, kbrite, ibasfreq, gi_Sweeper_sine, gioctfn, ioctcnt, iphs
a1 hsboscil kenvelope, ktone, kbrite, ibasfreq, gi_Sweeper_sine, gi_Sweeper_octfn, ioctcnt, iphs
amod poscil3 0.25, ibasfreq*(1/3), gi_Sweeper_sine
arm = a1*amod
kmix expseg 0.001, 0.01, rnd(1), rnd(3)+0.3, 0.001
kmix=.25
a1 ntrpol a1, arm, kmix
;a1 pareq a1/10, 400, 15, .707
;a1 tone a1, 500
kpanrte jspline 5, 0.05, 0.1
kpandep jspline 0.9, 0.2, 0.4
kpan poscil3 kpandep, kpanrte, gi_Sweeper_sine
a1,a2 pan2 a1, kpan
a1 delay a1, rnd(0.1)
a2 delay a2, rnd(0.11)
kenv linsegr 1, 1, 0
kenv = kenvelope
aleft = a1*kenv*.02
aright = a2*kenv*.02
adamping linseg 0, 0.03, 1, p3 - 0.1, 1, 0.07, 0
aleft = adamping * aleft
aright = adamping * aright
chnmix aleft, "out_left"
chnmix aright, "out_right"
prints "instr %4d t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f\n", p1, p2, p3, p4, p5, p7
endin

gi_Buzzer_overlap init 20
gk_Buzzer_harmonics init 2
gk_Buzzer_distort_factor init 0.4
gk_Buzzer_first_harmonic init 0.4
gi_Buzzer_sine ftgen 0, 0, 65536, 10, 1
instr Buzzer
insno = p1
istart = p2
iduration = p3
ikey = p4
ivelocity = p5
iphase = p6
ipan = p7
iamp = ampdb(ivelocity) * 4
iattack = gi_Buzzer_overlap
idecay = gi_Buzzer_overlap
isustain = p3 - gi_Buzzer_overlap
p3 = iattack + isustain + idecay
kenvelope transeg 0.0, iattack / 2.0, 1.5, iamp / 2.0, iattack / 2.0, -1.5, iamp, isustain, 0.0, iamp, idecay / 2.0, 1.5, iamp / 2.0, idecay / 2.0, -1.5, 0
ihertz = cpsmidinn(ikey)
asignal buzz kenvelope, ihertz, gk_Buzzer_harmonics, gi_Buzzer_sine
asignal = asignal * 3
aleft, aright pan2 asignal, ipan
adamping linseg 0, 0.03, 1, p3 - 0.1, 1, 0.07, 0
aleft = adamping * aleft
aright = adamping * aright
chnmix aleft, "out_left"
chnmix aright, "out_right"
prints "instr %4d t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f\n", p1, p2, p3, p4, p5, p7
endin

gi_Shiner_overlap init 20
gk_Shiner_harmonics init 5
gk_Shiner_harmonics init 2
gk_Shiner_distort_factor init 0.4
gk_Shiner_first_harmonic init 0.4
gi_Shiner_sine ftgen 0, 0, 65536, 10, 1
instr Shiner
insno = p1
istart = p2
iduration = p3
ikey = p4
ivelocity = p5
iphase = p6
ipan = p7
iamp = ampdb(ivelocity) * 4
iattack = gi_Shiner_overlap
idecay = gi_Shiner_overlap
isustain = p3 - gi_Shiner_overlap
p3 = iattack + isustain + idecay
kenvelope transeg 0.0, iattack / 2.0, 1.5, iamp / 2.0, iattack / 2.0, -1.5, iamp, isustain, 0.0, iamp, idecay / 2.0, 1.5, iamp / 2.0, idecay / 2.0, -1.5, 0
ihertz = cpsmidinn(ikey)
asignal vco2 kenvelope * 4, ihertz, 12
aleft, aright pan2 asignal, ipan
adamping linseg 0, 0.03, 1, p3 - 0.1, 1, 0.07, 0
aleft = adamping * aleft
aright = adamping * aright
chnmix aleft, "out_left"
chnmix aright, "out_right"
prints "instr %4d t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f\n", p1, p2, p3, p4, p5, p7
endin

gi_Blower_overlap init 20
gk_Blower_grainDensity init 150
gk_Blower_grainDuration init 0.2
gk_Blower_grainAmplitudeRange init 100
gk_Blower_grainFrequencyRange init .033
gi_Blower_grtab ftgen 0, 0, 65536, 10, 1, .3, .1, 0, .2, .02, 0, .1, .04
gi_Blower_wintab ftgen 0, 0, 65536, 10, 1, 0, .5, 0, .33, 0, .25, 0, .2, 0, .167
instr Blower
i_instrument = p1
i_time = p2
i_duration = p3
i_midikey = p4
i_midivelocity = p5
i_phase = p6
i_pan = p6
i_depth = p8
i_height = p9
i_pitchclassset = p10
i_homogeneity = p11
ifrequency = cpsmidinn(i_midikey)
iamplitude = ampdb(i_midivelocity) / 200
 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
 ; f1 0 65536 1 "hahaha.aif" 0 4 0
 ; f2 0 1024 7 0 224 1 800 0
 ; f3 0 8192 7 1 8192 -1
 ; f4 0 1024 7 0 512 1 512 0
 ; f5 0 1024 10 1 .3 .1 0 .2 .02 0 .1 .04
 ; f6 0 1024 10 1 0 .5 0 .33 0 .25 0 .2 0 .167
 ; a0 14 50
 ; p1 p2 p3 p4 p5 p6 p7 p8 p9 p10
 ; Start Dur Amp Freq GrTab WinTab FqcRng Dens Fade
 ; i1 0.0 6.5 700 9.00 5 4 .210 200 1.8
 ; i1 3.2 3.5 800 7.08 . 4 .042 100 0.8
 ; i1 5.1 5.2 600 7.10 . 4 .0320 100 0.9
 ; i1 7.2 6.6 900 8.03 . 4 .021 150 1.6
 ; i1 21.3 4.5 1000 9.00 . 4 .031 150 1.2
 ; i1 26.5 13.5 1100 6.09 . 4 .121 150 1.5
 ; i1 30.7 9.3 900 8.05 . 4 .014 150 2.5
 ; i1 34.2 8.8 700 10.02 . 4 .14 150 1.6
iHz = ifrequency
ihertz = iHz
ip4 = iamplitude
ip5 = iHz
ip6 = gi_Blower_grtab
ip7 = gi_Blower_wintab
ip8 = 0.033
ip8 = .002
ip9 = 150
ip9 = 100
ip10 = 1.6
ip10 = 3
idur = p3
iamp = iamplitude ; p4
ifqc = iHz ; cpspch(p5)
igrtab = ip6
iwintab = ip7
ifrng = ip8
idens = ip9
ifade = ip10
igdur = 0.2
iattack = gi_Blower_overlap
idecay = gi_Blower_overlap
isustain = p3 - gi_Blower_overlap
p3 = iattack + isustain + idecay
kenvelope transeg 0.0, iattack / 2.0, 1.5, iamp / 2.0, iattack / 2.0, -1.5, iamp, isustain, 0.0, iamp, idecay / 2.0, 1.5, iamp / 2.0, idecay / 2.0, -1.5, 0
; kamp linseg 0, ifade, 1, idur - 2 * ifade, 1, ifade, 0
kamp = kenvelope
; Amp Fqc Dense AmpOff PitchOff GrDur GrTable WinTable MaxGrDur
aoutl grain ip4, ifqc, gk_Blower_grainDensity, gk_Blower_grainAmplitudeRange, ifqc * gk_Blower_grainFrequencyRange, gk_Blower_grainDuration, gi_Blower_grtab, gi_Blower_wintab, 5
aoutr grain ip4, ifqc, gk_Blower_grainDensity, gk_Blower_grainAmplitudeRange, ifqc * gk_Blower_grainFrequencyRange, gk_Blower_grainDuration, gi_Blower_grtab, gi_Blower_wintab, 5
aleft = aoutl * kamp * iamplitude
aright = aoutr * kamp * iamplitude
adamping linseg 0, 0.03, 1, p3 - 0.1, 1, 0.07, 0
aleft = adamping * aleft
aright = adamping * aright
chnmix aleft, "out_left"
chnmix aright, "out_right"
prints "instr %4d t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f\n", p1, p2, p3, p4, p5, p7
endin

instr Controls
gk_Droner_slider1 chnget "gk_Droner_slider1"
gk_Droner_slider2 chnget "gk_Droner_slider2"
gk_Droner_slider3 chnget "gk_Droner_slider3"
gk_Droner_slider4 chnget "gk_Droner_slider4"
gk_Droner_slider5 chnget "gk_Droner_slider5"
gk_Buzzer_harmonics chnget "gk_Buzzer_harmonics"
gk_Blower_grainDensity chnget "gk_Blower_grainDensity"
gk_Blower_grainDuration chnget "gk_Blower_grainDuration"
gk_Blower_grainAmplitudeRange chnget "gk_Blower_grainDuration"
gk_Blower_grainFrequencyRange chnget "gk_Blower_grainFrequencyRange"
gk_Reverb_Feedback chnget "gk_Reverb_Feedback"
gk_MasterOutput_gain chnget "gk_MasterOutput_gain"
prints "instr %4d t %12.4f d %12.4f k %9.4f v %9.4f p %9.4f\n", p1, p2, p3, p4, p5, p7
endin

gk_Reverb_Feedback init 0.975
gk_Reverb_DelayModulation init 0.875
instr Reverb
ain_left chnget "out_left"
ain_right chnget "out_right"
azero init 0
aout_left init 0
aout_left, aright reverbsc ain_left, azero, gk_Reverb_Feedback, 15000.0
aleft init 0
azero init 0
aleft, aout_right reverbsc azero, ain_right, gk_Reverb_Feedback, 15000.0
chnmix aout_left, "reverb_out_left"
chnmix aout_right, "reverb_out_right"
prints "instr %4d t %9.4f d %9.4f k %9.4f v %9.4f p %9.4f\n", p1, p2, p3, p4, p5, p7
endin

gk_MasterOutput_gain init .000003
instr MasterOutput
ain_left chnget "reverb_out_left"
ain_right chnget "reverb_out_right"
aout_left = ain_left * gk_MasterOutput_gain * .000001
aout_right = ain_right * gk_MasterOutput_gain * .000001
outs aout_left, aout_right
prints "instr %4d t %12.4f d %12.4f k %9.4f v %9.4f p %9.4f\n", p1, p2, p3, p4, p5, p7
endin

instr Clear
chnclear "out_left"
chnclear "out_right"
chnclear "reverb_out_left"
chnclear "reverb_out_right"
prints "instr %4d t %12.4f d %12.4f k %9.4f v %9.4f p %9.4f\n", p1, p2, p3, p4, p5, p7
endin

scoreline_i "i \"Controls\" 0 -1"
scoreline_i "i \"Reverb\" 0 -1"
scoreline_i "i \"MasterOutput\" 0 -1"
scoreline_i "i \"Clear\" 0 -1"
    </textarea>
    <h4>Csound Score</h4>
    <textarea class="code" id="sco" rows=24 cols=80>
; Change the tempo, if you like.
t 0 27

; p1 p2 p3 p4 p5 p6 p7 p8
; insno onset duration fundamental numerator denominator velocity pan

; C E B
; [numerator/denominator*fundamental*octave]
i 101   0 60 [ 1 /  1 * 60 * 1] 60 [-1 + 3 / 2]
i 101   0 60 [ 5 /  4 * 60 * 2] 60 [-1 + 2 / 2]
i 101   0 30 [28 / 15 * 60 * 3] 60 [-1 + 1 / 2]
; C Ab E B
i 104  30 30 [ 8 /  5 * 60 * 1] 60 [-1 + 2 / 2]
; G F# B
i 102  60 60 [ 3 /  2 * 60 * 1] 60 [-1 + 3 / 2]
i 102  60 60 [45 / 32 * 60 * 2] 60 [-1 + 2 / 2]
i 102  60 30 [28 / 15 * 60 * 3] 60 [-1 + 1 / 2]
; G F B
i 102  90 30 [ 4 / 3 * 60 * 3] 60 [-1 + 2 / 2]
; C E B
i 103 120 60 [ 1 /  1 * 60 * 1] 60 [-1 + 1 / 2]
i 103 120 60 [ 5 /  4 * 60 * 2] 60 [-1 + 3 / 2]
i 104 120 30 [28 / 15 * 60 * 2] 60 [-1 + 2 / 2]
i 103 150 30 [ 1 /  1 * 60 * 5] 60 [-1 + 2 / 2]
    </textarea>
    <h2>How It Is Done</h4>
    <p>This tutorial is a simple example. All unnecessary HTML elements and JavaScript function calls have been 
    omitted. This Web page uses only a subset of the Csound API that has the same funtions, names, and signatures 
    in csound.node, Csound for Android, CsoundQt, and Csound for PNaCl. This piece will not run without modification
    in these other environments, although that is a goal for the Csound developers. But the changes required are 
    simple, and I explain them in an Appendix to this chapter, "Interoperable HTML5 for Csound".</p>
    <p>Comments on this page or in the page source explain what each element is for and why it is 
    written the way it is. You can view the code and comments by right-clicking on this page and selecting 
    "View page source".</p>
    <h3>Embedding Csound</h3>
    <p>PNaCl (Portable Native Client, pronounced "pinnacle") is Google's technology for <i>safely</i> 
    running C and C++ code in all desktop versions of Google's Chrome browser. For more information on PNaCl, 
    go <a href='https://developer.chrome.com/native-client'>here</a>. Very briefly:
    <ul>
        <li>PNaCl applications must be loaded from a Web server. In this case, that is GitHub, the host for 
        <a href='http://gogins.github.io/csound/'>http://gogins.github.io</a>.</li>
        <li>PNaCl applications are compiled twice using Google's toolchain: first by the developer to compile a 
        .pexe file for the browser to load, and then by the browser itself to compile the .pexe (portable executable)
        file into native machine language for the browser's CPU as a .nexe (native executable) file that is cached 
        for re-use. Because the application runs as native machine language, it runs only about 5% or 10% slower 
        than a regular compiled C or C++ program. For audio applications, this is a <i>huge</i> advantage.</li>
        <li>The browser knows how to load the application by reading an &lt;embed&gt; tag that points to the 
        .pexe file and to a .nmf manifest file that tells the browser how to compile the .pexe file.</li>
        <li>The application runs in a security sandbox in a separate process, and communicates with the 
        browser only by means of asynchronous messages sent via Google's Pepper API.</li>
    </ul>
    <p>To embed Csound for PNaCl in a Web page, simply load the "csound.js" script using a &lt;script&gt; element. 
    This contains JavaScript that dynamically creates the &lt;embed&gt; element, and also manages sending and 
    receiving messages from the Csound process. As far as any JavaScript code on the Web page is concerned, 
    Csound is just an already existing JavaScript object named "csound", with 
    its own functions and callbacks, which represent important parts of the Csound API.</p>
    <p>It is good practice to place all &lt;script&gt; elements at the very end of the HTML &lt;body&gt; element, 
    so that the other elements have already been created before any scripts try to access them, and that is what 
    I have done here.</p>
    <p>Finally, the very last element in the body must be named "engine". The "csound.js" script obtains this 
    element from the JavaScript document object for the page, and attaches to it the &lt;embed&gt; element and 
    Csound's callbacks.</p>
    <p>So, the code for embedding Csound for PNaCl in a Web page looks like this:</p>
    <xmp>
	<script type="text/javascript" src="csound.js"></script>
	<div id="engine"></div>
    </xmp>
    <h3>Embedding the Csound Score and Orchestra</h3>
    <p>There are many ways to get a Csound piece into Csound for PNaCl. But in order to make the Csound orchestra 
    and score editable, they must appear in &lt;textarea&gt; elements on the Web page. These can be smaller than 
    the text they contain, yet have scrollbars for accessing all of the text. These textareas must be named, 
    so that we can use JavaScript to retrieve the orchestra and score and pass them to Csound.</p>
    <p>The code for a textarea containing a Csound orchestra looks like this:</p>
    <xmp>
    <textarea id="orc" rows=24 cols=80>
opcode hertz2midinn, i, i
ihertz xin
print ihertz
; m = 12*log2(fm/440 Hz) + 69
ilog2 = log(2)
imidinn = 12 * (log(ihertz / 440) / ilog2) + 69
print imidinn
xout imidinn
endop

instr 101
insno = p1
istart = p2
iduration = p3
ihertz = p4
ivelocity = p5
ipan = p6
ikey hertz2midinn ihertz
event_i "i", "Droner", 0, iduration, ikey, ivelocity, 0, ipan
endin
(...remainder of orchestra...)
    </textarea>    	
    </xmp>
    <p>Please note, Csound system constants are set by "csound.js" and cannot be set in the orchestra header, 
    so they are omitted here. Because "csound.js" sets 0dbfs to 1, but this piece assumes a 0dbfs level 
    of 32768, we have edited the orchestra drastically reduce the output level.</p>
    <p>The code for a textarea containing a Csound score works the same way.</p>
    <p>Also note, Csound for PNaCl can perform scores using either <code>csound.compileOrc(orc_text)</code> 
    followed by <code>csound.readScore(sco_text)</code>, or by simply calling 
    <code>csound.playCsd(filename)</code>. If <code>readScore</code> is used, the score must not contain any 
    "t", "s", or "e" statements, and all score times must be absolute times in seconds from the beginning of 
    the performance. If <code>playCsd</code> is used, any and all standard score statements may be used.</p>
    <h3>Starting and Stopping Csound</h3>
    <p>It is convenient to provide buttons for starting and stopping Csound, rather than simply having it start 
    playing the moment the page is loaded. The JavaScript code for handling the button clicks must start 
    Csound, send the orchestra to Csound, and send the score, in order to perform the piece.</p>
    <p>Here we use the very convenient library, jQuery, to automate the construction of the handlers 
    for all of the buttons and the sliders in this piece. jQuery has an abbreviated syntax that accepts generic 
    and individual element IDs, and we can use functional programming techniques to further simplify the 
    code, automatically manufacturing the handlers according to their HTML element types and names.</p>
    <p>Finally, jQuery knows how to store the values of HTML elements with the "class" attribute "persistent-element" 
    in HTML local storage, and retrieve it again. The "Save" button stores the values of all the persistent elements, not only 
    the sliders but also any edits to the orchestra and score, to local storage. The "Restore" button replaces 
    the current values of these elements with the stored values. The "Restore" funtion is automatically invoked 
    at the start of each Csound performance, as well. Some facility such as this is not only very convenient for 
    remembering control settings between performances of a piece, but well-nigh required for any practical 
    work on a real composition. </p>
    <p>The code for all the buttons and sliders above then looks like this:</p>
    <xmp>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js">
    </script>
    <script>    
    // The usual pattern of creating all jQuery handlers in the document's on ready handler,
    // when the DOM has been constructed, does not work here because of the way Csound is 
    // initialized by the csound.js script, and so is commented out here.
    // $(document).ready(function() {
        $('#play').on('click', function() {      	
            csound.perform();
            $('#restore').trigger('click');
            csound.compileOrc(document.getElementById('orc').value);
            csound.readScore(document.getElementById('sco').value);
        });
        $('#stop').on('click', function() {      	
            csound.stop();
        });
        $('input').on('input', function(event) {
            var slider_value = event.target.value;
            csound.setControlChannel(event.target.id, slider_value);
            var output_selector = '#' + event.target.id + '_output';
            $(output_selector).val(slider_value);
        });
        $('#save').on('click', function() {
            $('.persistent-element').each(function() {
                localStorage.setItem(this.id, this.value);
            });
        });
        $('#restore').on('click', function() {
            $('.persistent-element').each(function() {
                this.value = localStorage.getItem(this.id);
                csound.setControlChannel(this.id, this.value);
                var output_selector = '#' + this.id + '_output';
                $(output_selector).val(this.value);
            });
        });
	// Messages both from the "csound.js" wrapper and from Csound itself are combined in the 
	// "console" text area.
	function handleMessage(message) {
	    var messages_textarea = document.getElementById("console");
	    var existing = messages_textarea.value;
	    messages_textarea.value = existing + message.data;
	    messages_textarea.scrollTop = messages_textarea.scrollHeight;    
	};

    //  });
    </script>
    </xmp>
    <p>In this piece, I have used a naming convention to simplify not only the HTML and JavaScript code, but 
    also the Csound orchestra. Each instrument's interactive controls are based on global variables that are
    declared just above the <code>instr</code> definition. Each name starts with <code>gk</code> to identify 
    the variable as a global, control-rate variable. Then comes the literal name of the instrument. 
    Then comes a name for the musical function of the variable. These 
    parts are separated by underscores. Each variable is initialized with a suitable default value. For example:</p>
    <xmp>
gk_Blower_grainDensity init 150
gk_Blower_grainDuration init 0.2
gk_Blower_grainAmplitudeRange init 100
gk_Blower_grainFrequencyRange init .033
gi_Blower_grtab ftgen 0, 0, 65536, 10, 1, .3, .1, 0, .2, .02, 0, .1, .04
gi_Blower_wintab ftgen 0, 0, 65536, 10, 1, 0, .5, 0, .33, 0, .25, 0, .2, 0, .167
instr Blower
i_instrument = p1
i_time = p2
i_duration = p3
(...remainder of instrument...)
chnmix aleft, "out_left"
chnmix aright, "out_right"
endin
    </xmp>
    <p>Note that function tables used the instrument are also declared and initialized just above 
    the <code>instr</code> definition. The instruments do not send audio directly to the 
    output, but rather to a named output channel using the <code>chnmix</code> opcode. 
    This means that each instrument definition, along with its 
    associated control variables and function tables, can be treated as a single, encapsulated block 
    of code that can be cut and pasted, moved around in the orchestra, or copied into another 
    orchestra without breaking.</p>
    <p>Each control slider in the user interface has exactly the same name as the corresponding control 
    variable, and the control channel itself also uses this name. Then, in the Csound orchestra, there 
    is one, always-on <code>Controls</code> instrument that simply reads in all the control channel values and 
    assigns them to the global control channels:</p>
    <xmp>
instr Controls
gk_Droner_slider1 chnget "gk_Droner_slider1"
gk_Droner_slider2 chnget "gk_Droner_slider2"
gk_Droner_slider3 chnget "gk_Droner_slider3"
gk_Droner_slider4 chnget "gk_Droner_slider4"
gk_Droner_slider5 chnget "gk_Droner_slider5"
gk_Buzzer_harmonics chnget "gk_Buzzer_harmonics"
gk_Blower_grainDensity chnget "gk_Blower_grainDensity"
gk_Blower_grainDuration chnget "gk_Blower_grainDuration"
gk_Blower_grainAmplitudeRange chnget "gk_Blower_grainDuration"
gk_Blower_grainFrequencyRange chnget "gk_Blower_grainFrequencyRange"
gk_Reverb_Feedback chnget "gk_Reverb_Feedback"
gk_MasterOutput_gain chnget "gk_MasterOutput_gain"
endin
    </xmp>
    <h3>Handling Csound's Errors, Warnings, and Messages</h3>
    <p>Csound for PNaCl will send all of its runtime messages to a JavaScript function in the Web page named 
    "handleMessage". This callback is automatically invoked by the "csound.js" script. Anything could be done 
    with these messages, including discarding them. Here, we append them to an initially empty textarea element named 
    "console". The "csound.js" script also sends its messages, prefaced "Csound:", to the "console" element; 
    therefore, this one textarea captures all messages from Csound for PNaCl.</p>
    <p>The code for handling messages from Csound looks like this:</p>
    <xmp>
    // Messages both from the "csound.js" wrapper and from Csound itself are combined in the 
    // "console" text area.
    function handleMessage(message) {
        var messages_textarea = document.getElementById("console");
        var existing = messages_textarea.value;
        messages_textarea.value = existing + message.data;
        messages_textarea.scrollTop = messages_textarea.scrollHeight;    
    }
    </xmp>
    <h2>Custom Styles</h2>
    <p>In HTML cascading style sheets (CSS) are declared or inluded at the top of a document in order to change the 
    default appearance of the HTML elements. This is a deep topic and I can provide only a glimpse of the possibilities 
    here, but essentially professional-level typography and graphic design can be implemented in Web pages using CSS.</p>
    <p>CSS styles begin with a "selector" that determines to which elements (or even single element) the style will be 
    applied. In the following CSS for this piece, most of the styles apply generically to all elements of a given type, 
    so the selector is simply the HTML element name, e.g. <code>h1</code>. For the sliders, the style is written to apply 
    only to <code>input</code> elements of type <code>range</code>, i.e. sliders. However, there are two types of 
    <code>textarea</code> in this piece: the one that displays Csound's runtime messages, warnings, and errors, and the 
    ones that contain the orchestra and score code. Therefore, the selector begins with the element type, then comes 
    a period followed immediately by a class name, e.g. <code>textarea.console</code>. The style is then applied to the 
    <code>textareas</code> using just the class attribute and selector, see below for the example.</p>
    <xmp>
   <style type="text/css">
    input[type='range'] {
        -webkit-appearance: none;
        border-radius: 5px;
        box-shadow: inset 0 0 5px #333;
        background-color: #999;
        height: 10px;
        width: 100%;
        vertical-align: middle;
    }
    input[type=range]::-webkit-slider-thumb {
        -webkit-appearance: none;
        border: none;
        height: 16px;
        width: 16px;
        border-radius: 50%;
        background: yellow;
        margin-top: -4px;
        border-radius: 10px;
    }
    table td {
        border-width: 2px;
        padding: 8px;
        border-style: solid;
        border-color: transparent;
        color:yellow;
        background-color: teal;
        font-family: sans-serif
    }
    table th {
        border-width: 2px;
        padding: 8px;
        border-style: solid;
        border-color: transparent;
        color:white;
        background-color:teal;
         font-family: sans-serif
   }
    textarea.console {
        border-width: 2px;
        padding: 8px;
        border-style: solid;
        border-color: gray;
        color:green;
        background-color:black;
        font-family: 'Courier', sans-serif
    }
    textarea.code {
        border-width: 2px;
        padding: 8px;
        border-style: solid;
        border-color: gray;
        color:black;
        background-color:white;
        font-family: 'Courier', sans-serif
    }
    h1 {
	margin: 1em 0 0.5em 0;
	color: #343434;
	font-weight: normal;
	font-family: 'Ultra', sans-serif;   
	font-size: 36px;
	line-height: 42px;
	text-transform: uppercase;
    }
    h2 {
        margin: 1em 0 0.5em 0;
        color: #343434;
        font-weight: normal;
        font-size: 30px;
        line-height: 40px;
        font-family: 'Orienta', sans-serif;
    }    
        h3 {
        margin: 1em 0 0.5em 0;
        color: #343434;
        font-weight: normal;
        font-size:24px;
        line-height: 30px;
        font-family: 'Orienta', sans-serif;
    }    
 </style>
    </xmp>
    <p>Please be aware that there are many, many different style properties that are not mentioned in the 
    above styles; in such cases the default value of the property, specified in the HTML standard, is applied. 
    It is helpful that in HTML5 most style properties can be applied to any type of element.</p>
    <script src="https://cdn.bootcss.com/three.js/r45/Three.js"></script>
    <script src="https://cdn.bootcss.com/stats.js/r6/Stats.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/2.3.0/math.js"></script>
    <script>
/**
 * @author alteredq / http://alteredqualia.com/
 * @author mr.doob / http://mrdoob.com/
 */

Detector = {

	canvas : !! window.CanvasRenderingContext2D,
	webgl : ( function () { try { return !! window.WebGLRenderingContext && !! document.createElement( 'canvas' ).getContext( 'experimental-webgl' ); } catch( e ) { return false; } } )(),
	workers : !! window.Worker,
	fileapi : window.File && window.FileReader && window.FileList && window.Blob,

	getWebGLErrorMessage : function () {

		var domElement = document.createElement( 'div' );

		domElement.style.fontFamily = 'monospace';
		domElement.style.fontSize = '13px';
		domElement.style.textAlign = 'center';
		domElement.style.background = '#eee';
		domElement.style.color = '#000';
		domElement.style.padding = '1em';
		domElement.style.width = '475px';
		domElement.style.margin = '5em auto 0';

		if ( ! this.webgl ) {

			domElement.innerHTML = window.WebGLRenderingContext ? [
				'Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation">WebGL</a>.<br />',
				'Find out how to get it <a href="http://get.webgl.org/">here</a>.'
			].join( '\n' ) : [
				'Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation">WebGL</a>.<br/>',
				'Find out how to get it <a href="http://get.webgl.org/">here</a>.'
			].join( '\n' );

		}

		return domElement;

	},

	addGetWebGLMessage : function ( parameters ) {

		var parent, id, domElement;

		parameters = parameters || {};

		parent = parameters.parent !== undefined ? parameters.parent : document.body;
		id = parameters.id !== undefined ? parameters.id : 'oldie';

		domElement = Detector.getWebGLErrorMessage();
		domElement.id = id;

		parent.appendChild( domElement );

	}

};
    </script>
    <script>
          /**
           * AUTHOR: Iacopo Sassarini
           * Based on Barry Martin's formula for the hopalong fractal.
           * Adapted for music generation by Michael Gogins.
           */
        // TODO: Augment random shuffling with slider control
        // of the parameters. One slider will control the
        // degree of randomness.
        //
        // There will also be buttons to perform chord
        // transformations.
        //
        // At some point, not sure just how or where yet,
        // the orbits will be translated to Csound notes,
        // conformed to the current chord, and sent to Csound.
        // X will be instrument choice, Y will be pitch, and
        // color will be loudness (V) and perhaps more.
        //
        // The notes have to be thinned out somehow. That
        // could be done by dividing up the plane of intersection
        // into a coarse grid, e.g. 60 semitones high, 7 or
        // 9 instruments across, and 2 or 3 notes per instrument.
        //
        // THis can be used perhaps to detect intersection: https://stemkoski.github.io/Three.js/Collision-Detection.html

        if ( ! Detector.webgl ) Detector.addGetWebGLMessage();

        var VISUALS_VISIBLE = true;
        var SCALE_FACTOR = 1500;
        var CAMERA_BOUND = 200;
        var NUM_POINTS_SUBSET = 40000;
        var NUM_SUBSETS       = 7;
        var NUM_POINTS = NUM_POINTS_SUBSET * NUM_SUBSETS;
        var NUM_LEVELS = 5;
        var LEVEL_DEPTH = 400;
        var DEF_BRIGHTNESS = .5;
        var DEF_SATURATION = 0.8;
        var SPRITE_SIZE = Math.ceil(3 * window.innerWidth / 1600);
        // Orbit parameters constraints
        var A_MIN = -30;
        var A_MAX = 30;
        var B_MIN = .2;
        var B_MAX = 1.8;
        var C_MIN = 5;
        var C_MAX = 17;
        var D_MIN = 0;
        var D_MAX = 10;
        var E_MIN = 0;
        var E_MAX = 12;
        // Orbit parameters
        var a, b, c, d, e;
        // Orbit data
        var orbit = {
            subsets: [],
            xMin: 0,
            xMax: 0,
            yMin: 0,
            yMax: 0,
            scaleX: 0,
            scaleY: 0
        }
        // Initialize data points
        for (var i = 0; i < NUM_SUBSETS; i++){
            var subsetPoints = [];
            for (var j = 0; j < NUM_POINTS_SUBSET; j++){
                subsetPoints[j] = {
                    x: 0,
                    y: 0,
                    vertex:  new THREE.Vertex(new THREE.Vector3(0,0,0))
                };
            }
            orbit.subsets.push(subsetPoints);
        }
        var container, stats;
        var camera, scene, renderer, composer, hueValues = [];
        var mouseX = 0, mouseY = 0;
        var windowHalfX = window.innerWidth / 2;
        var windowHalfY = window.innerHeight / 2;
        var speed = 0.25;
        var rotationSpeed = 0.001;
        init();
        animate();
        function init() {
        // Use base64 encoded image to avoid cross-domain problems.
        var galaxy = new Image();
        galaxy.src = "data:image/png;base64,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";
        sprite1 = THREE.ImageUtils.loadTexture(galaxy.src);
            container = document.createElement( 'div' );
            document.body.appendChild( container );
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 3 * SCALE_FACTOR );
            camera.position.z = SCALE_FACTOR / 2;
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2( 0x000000, 0.0012);
            generateOrbit();
            for (var s = 0; s < NUM_SUBSETS; s++) {
                hueValues[s] = Math.random();
            }
            // Create particle systems
            for (var k = 0; k < NUM_LEVELS; k++){
                for (var s = 0; s < NUM_SUBSETS; s++){
                    var geometry = new THREE.Geometry();
                    for (var i = 0; i < NUM_POINTS_SUBSET; i++) {
                        geometry.vertices.push( orbit.subsets[s][i].vertex);
                    }
                    var materials = new THREE.ParticleBasicMaterial( { size: (SPRITE_SIZE ), map: sprite1, blending: THREE.AdditiveBlending, depthTest: false, transparent : true } );
                    materials.color.setHSV(hueValues[s], DEF_SATURATION, DEF_BRIGHTNESS);
                    var particles = new THREE.ParticleSystem( geometry, materials );
                    particles.myMaterial = materials;
                    particles.myLevel = k;
                    particles.mySubset = s;
                    particles.position.x = 0;
                    particles.position.y = 0;
                    particles.position.z = - LEVEL_DEPTH * k - (s  * LEVEL_DEPTH / NUM_SUBSETS) + SCALE_FACTOR/2;
                    particles.needsUpdate = 0;
                    scene.add( particles );
                }
            }
            // Setup renderer and effects.
            renderer = new THREE.WebGLRenderer( { clearColor: 0x000000, clearAlpha: 1, antialias: false } );
            renderer.setSize( window.innerWidth, window.innerHeight );
            container.appendChild( renderer.domElement );

            stats = new Stats();
            stats.domElement.style.position = 'absolute';
            stats.domElement.style.top = '5px';
            stats.domElement.style.right = '5px';
            container.appendChild( stats.domElement );

            // Setup listeners
            document.addEventListener( 'mousemove', onDocumentMouseMove, false );
            document.addEventListener( 'touchstart', onDocumentTouchStart, false );
            document.addEventListener( 'touchmove', onDocumentTouchMove, false );
            document.addEventListener( 'keydown', onKeyDown, false );
            window.addEventListener( 'resize', onWindowResize, false );

            // Schedule orbit regeneration
            setInterval(updateOrbit, 7000);
        }

        function animate() {
            requestAnimationFrame( animate );
            render();
            stats.update();
        }
a
        // The objects here are planes each containing one particle system
        // of hopalong orbits. As with the objects going past the camera z,
        // when objects go past some z deeper than the camera z,
        // create notes. The points will be "thinned" into an array of notes, which will be scheduled.
        // The notes will persist for some fixed duration
        var note_depth = ((NUM_LEVELS/2) * LEVEL_DEPTH) / 2.0;
        console.log('note_depth:' + note_depth);
        var note_origin = - SCALE_FACTOR;
        var note_range = 2.0 * SCALE_FACTOR;
        function createNotes(scene) {
           for ( i = 0; i < scene.objects.length; i++ ) {
                var scene_object = scene.objects[i];
                if (scene_object.position.z >= 400 && scene_object.position.z <= (400 + speed)) {
                    console.log('object on:  ' + i + '  depth: ' + scene_object.position.z);
                    var vertex = scene_object.geometry.vertices[0];
                    var maxx = vertex.position.x;
                    var minx = vertex.position.x;
                    var maxy = vertex.position.y;
                    var miny = vertex.position.y;
                    for (var j = 0; j < scene_object.geometry.vertices.length; ++j) {
                        vertex = scene_object.geometry.vertices[j];
                        var key = Math.floor((((vertex.position.y / note_range) + .5) * 60.0) + 36.);
                        var instrument = Math.floor((((vertex.position.x / note_range) + .5) * 10.) + 1.);
                        //console.log('key: ' + key + ' instrument: ' + instrument);
                    };
                }
            }
        }

        function render() {
            //console.log('render()...')
            if (camera.position.x >= - CAMERA_BOUND && camera.position.x <= CAMERA_BOUND){
                camera.position.x += ( mouseX - camera.position.x ) * 0.05;
                if (camera.position.x < - CAMERA_BOUND) camera.position.x = -CAMERA_BOUND;
                if (camera.position.x >  CAMERA_BOUND) camera.position.x = CAMERA_BOUND;
            }
            if (camera.position.y >= - CAMERA_BOUND && camera.position.y <= CAMERA_BOUND){
                camera.position.y += ( - mouseY - camera.position.y ) * 0.05;
                if (camera.position.y < - CAMERA_BOUND) camera.position.y = -CAMERA_BOUND;
                if (camera.position.y >  CAMERA_BOUND) camera.position.y = CAMERA_BOUND;
            }

            camera.lookAt( scene.position );
            createNotes(scene);

            for( i = 0; i < scene.objects.length; i++ ) {
                scene.objects[i].position.z +=  speed;
                scene.objects[i].rotation.z += rotationSpeed;
                if (scene.objects[i].position.z > camera.position.z){
                    scene.objects[i].position.z = - (NUM_LEVELS -1) * LEVEL_DEPTH;
                    if (scene.objects[i].needsUpdate == 1){
                        scene.objects[i].geometry.__dirtyVertices = true;
                        scene.objects[i].myMaterial.color.setHSV( hueValues[scene.objects[i].mySubset], DEF_SATURATION, DEF_BRIGHTNESS);
                        scene.objects[i].needsUpdate = 0;
                    }
                }
            }
            renderer.render(scene, camera);
        }
        ///////////////////////////////////////////////
        // Hopalong Orbit Generator
        ///////////////////////////////////////////////
        function updateOrbit(){
            generateOrbit();
            for (var s = 0; s < NUM_SUBSETS; s++){
                hueValues[s] = Math.random();
            }
            for( i = 0; i < scene.objects.length; i++ ) {
                scene.objects[i].needsUpdate = 1;
            }
        }

        function generateOrbit(){
            var x, y, z, x1;
            var idx = 0;

            prepareOrbit();

            // Using local vars should be faster
            var al = a;
            var bl = b;
            var cl = c;
            var dl = d;
            var el = e;
            var subsets = orbit.subsets;
            var num_points_subset_l = NUM_POINTS_SUBSET;
            var num_points_l = NUM_POINTS;
            var scale_factor_l = SCALE_FACTOR;

            var xMin = 0, xMax = 0, yMin = 0, yMax = 0;

            for (var s = 0; s < NUM_SUBSETS; s++){

                // Use a different starting point for each orbit subset
                x = s * .005 * (0.5-Math.random());
                y = s * .005 * (0.5-Math.random());

                var curSubset = subsets[s];

                for (var i = 0; i < num_points_subset_l; i++){

                    // Iteration formula (generalization of the Barry Martin's original one)
                    z = (dl + Math.sqrt(Math.abs(bl * x - cl)));
                    if (x > 0) {x1 = y - z;}
                    else if (x == 0) {x1 = y;}
                    else {x1 = y + z;}
                    y = al - x;
                    x = x1 + el;

                    curSubset[i].x = x;
                    curSubset[i].y = y;

                    if (x < xMin) {xMin = x;}
                    else if (x > xMax) {xMax = x;}
                    if (y < yMin) {yMin = y;}
                    else if (y > yMax) {yMax = y;}
                    idx++;
                }
            }
            var scaleX = 2 * scale_factor_l / (xMax - xMin);
            var scaleY = 2 * scale_factor_l / (yMax - yMin);

            orbit.xMin = xMin;
            orbit.xMax = xMax;
            orbit.yMin = yMin;
            orbit.yMax = yMax;
            orbit.scaleX = scaleX;
            orbit.scaleY = scaleY;

            // Normalize and update vertex data.
            console.log('Normalizing and updating vertices.')
            for (var s = 0; s < NUM_SUBSETS; s++){
                var curSubset = subsets[s];
                for (var i = 0; i < num_points_subset_l; i++){
                    curSubset[i].vertex.position.x = scaleX * (curSubset[i].x - xMin) - scale_factor_l;
                    curSubset[i].vertex.position.y = scaleY * (curSubset[i].y - yMin) - scale_factor_l;
                }
            }
        }

        function prepareOrbit(){
            console.log('prepareOrbit()...')
            shuffleParams();
            orbit.xMin = 0;
            orbit.xMax = 0;
            orbit.yMin = 0;
            orbit.yMax = 0;
        }

        function shuffleParams() {
            a = A_MIN + Math.random() * (A_MAX - A_MIN);
            b = B_MIN + Math.random() * (B_MAX - B_MIN);
            c = C_MIN + Math.random() * (C_MAX - C_MIN);
            d = D_MIN + Math.random() * (D_MAX - D_MIN);
            e = E_MIN + Math.random() * (E_MAX - E_MIN);
        }

        ///////////////////////////////////////////////
        // Event listeners
        ///////////////////////////////////////////////
        function onDocumentMouseMove( event ) {
            mouseX = event.clientX - windowHalfX;
            mouseY = event.clientY - windowHalfY;
        }

        function onDocumentTouchStart( event ) {
            if ( event.touches.length == 1 ) {
                event.preventDefault();
                mouseX = event.touches[ 0 ].pageX - windowHalfX;
                mouseY = event.touches[ 0 ].pageY - windowHalfY;
            }
        }

        function onDocumentTouchMove( event ) {
            if ( event.touches.length == 1 ) {
                event.preventDefault();
                mouseX = event.touches[ 0 ].pageX - windowHalfX;
                mouseY = event.touches[ 0 ].pageY - windowHalfY;
            }
        }

        function onWindowResize( event ) {
            windowHalfX = window.innerWidth / 2;
            windowHalfY = window.innerHeight / 2;
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize( window.innerWidth, window.innerHeight );
        }

        function onKeyDown(event){
            if(event.keyCode == 38 && speed < 20) speed += .5;
            else if(event.keyCode == 40 && speed > 0) speed -= .5;
            else if(event.keyCode == 37) rotationSpeed += .001;
            else if(event.keyCode == 39) rotationSpeed -= .001;
            else if(event.keyCode == 72 || event.keyCode == 104) toggleVisuals();
        }

        function showHideAbout() {
            if (document.getElementById('about').style.display == "block") {
                document.getElementById('about').style.display = "none";
            } else {
                document.getElementById('about').style.display = "block";
            }
        }

        function toggleVisuals(){
            if(VISUALS_VISIBLE){
                document.getElementById('aboutlink').style.display = 'none';
                document.getElementById('about').style.display = 'none';
                document.getElementById('info').style.display = 'none';
                 stats.domElement.style.display = 'none';
                renderer.domElement.style.cursor = "none";
                VISUALS_VISIBLE = false;
            }
            else {
                 document.getElementById('aboutlink').style.display = 'block';
                document.getElementById('info').style.display = 'block';
                stats.domElement.style.display = 'block';
                renderer.domElement.style.cursor = "";
                VISUALS_VISIBLE = true;
            }
        }
        </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js">
    </script>
    <script>    
    // The usual pattern of creating all jQuery handlers in the document's on ready handler,
    // when the DOM has been constructed, does not work here because of the way Csound is 
    // initialized by the csound.js script, and so is commented out here.
    // $(document).ready(function() {
        $('#play').on('click', function() {      	
            csound.perform();
            $('#restore').trigger('click');
            csound.compileOrc(document.getElementById('orc').value);
            csound.readScore(document.getElementById('sco').value);
        });
        $('#stop').on('click', function() {      	
            csound.stop();
        });
        $('input').on('input', function(event) {
            var slider_value = event.target.value;
            csound.setControlChannel(event.target.id, slider_value);
            var output_selector = '#' + event.target.id + '_output';
            $(output_selector).val(slider_value);
        });
        $('#save').on('click', function() {
            $('.persistent-element').each(function() {
                localStorage.setItem(this.id, this.value);
            });
        });
        $('#restore').on('click', function() {
            $('.persistent-element').each(function() {
                this.value = localStorage.getItem(this.id);
                csound.setControlChannel(this.id, this.value);
                var output_selector = '#' + this.id + '_output';
                $(output_selector).val(this.value);
            });
        });
	// Messages both from the "csound.js" wrapper and from Csound itself are combined in the 
	// "console" text area.
	function handleMessage(message) {
	    var messages_textarea = document.getElementById("console");
	    var existing = messages_textarea.value;
	    messages_textarea.value = existing + message.data;
	    messages_textarea.scrollTop = messages_textarea.scrollHeight;    
	};

    //  });
    </script>
    <script type="text/javascript" src="csound.js"></script>
    <!--The PNaCl csound module must be the very last element in the body, 
        because the "csound.js" script attaches the Csound module and its 
        callbacks to that element. -->
    <div id="engine"></div>
</body>
</html>
