
<!DOCTYPE html>
<html>
<head>
    <title>Stria Example</title>
</head>
<body>
    <h1>Stria</h2>
    <h4>By John Chowning</h3>
    <h4>Reconstruction by K. Dahan</h4> 
    <h4>Web page by Michael Gogins</h4> 
    <h4>Original version by Victor Lazzarini</h4> 
    <p>This Web page provides a simple example of how to embed a piece of Csound music into a Web page,
    so that it is editable, and play it, using the PNaCl build of Csound, csound.pexe. All unnecessary 
    HTML elements and JavaScript function calls have been omitted.</p>
    <p>As we proceed through the tutorials, more and more features of HTML5 will be integrated with 
    Csound, adding features to this piece.</p>
    <p>Comments on the page or in the the page source explain what each element is for and why it is 
    written the way it is. You can view the code and comments by right-clicking on this page and selecting 
    "View page source".</p>
    <input type="button" value="Start playing" onclick="start_onclick()"/>
    <input type="button" value="Stop playing" onclick="stop_onclick()"/>
    <br>
    <br>
    <h3>Embedding csound.pexe</h3>
    <p>PNaCl ("pinnacle") is Google's technology for runnin C and C++ code in all desktop versions of 
    Google's Chrome browser. For more information on PNaCl, go 
    <a href='https://developer.chrome.com/native-client'>here</a>. I will not discuss the internals of PNaCl or 
    of the Csound build here, except to note that csound.pexe runs in a separate process and communicates with 
    the Web page using messages passed over Google's Pepper API. This messaging is managed by the "csound.js" 
    JavaScript wrapper that the Web page must load in order to use csound.pexe. This wrapper also dynamically 
    builds the "embed" tag that points to the csound.pexe file and its manifest.</p>
    <h3>Embedding the Csound Score and Orchestra</h3>
    <h3>Starting and Stopping Csound</h3>
    <h3>Handling Csound's Errors, Warnings, and Messages</h3>
    <textarea id="console" rows=10 cols=80></textarea>
    <script type="text/javascript" src="csound.js"></script>
    <script>
    // It is best practice to place all JavaScript elements at the end of the "body" element 
    // so that all other HTML elements have been initialized before any JavaScript code tries to 
    // access them.
    var start_onclick = function() {
        csound.PlayCsd("http/stria.csd");
    }
    // It is necessary to refresh the page to stop Csound, because the PNaCl build of Csound 
    // does not provide a "stop" function. However, this workaround seems to work well.
    var stop_onclick = function() {
        location.reload();
    }
    // Messages both from the "csound.js" wrapper and from Csound itself are combined in the 
    // "console" text area.
    function handleMessage(message) {
        var messages_textarea = document.getElementById("console");
        var existing = messages_textarea.value;
        messages_textarea.value = existing + message.data;
        messages_textarea.scrollTop = messages_textarea.scrollHeight;    
    }
    // The "engine" element should be the very last HTML element in the body. That is because 
    // the "csound.js" wrapper uses the "engine" element to embed the PNaCl Csound module in this Web page.
    </script>
    <!--pNaCl csound module-->
    <div id="engine"></div>
</body>
</html>

